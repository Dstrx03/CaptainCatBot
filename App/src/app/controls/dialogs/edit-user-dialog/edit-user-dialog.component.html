<mat-progress-bar mode="indeterminate" [style.visibility]="loadingData ? 'visible' : 'hidden'"></mat-progress-bar>
<h1 mat-dialog-title>{{data.addMode ? 'Add User' : 'Edit User'}}</h1>
<div mat-dialog-content>
  <div class="container form-fields-full-width">
    <div class="row">
      <div class="col">
        <mat-form-field>
          <mat-label>User Name</mat-label>
          <input matInput [(ngModel)]="user.UserName" [formControl]="usernameFormControl" required>
          <mat-error *ngIf="usernameFormControl.invalid">
            <span [innerHTML]="formControlHelper.errorMessage(usernameFormControl)"></span>
          </mat-error>
        </mat-form-field>
      </div>
      <div class="col">
        <mat-form-field>
          <mat-label>Email</mat-label>
          <input matInput [(ngModel)]="user.Email" [formControl]="emailFormControl" required>
          <mat-error *ngIf="emailFormControl.invalid">
            <span [innerHTML]="formControlHelper.errorMessage(emailFormControl)"></span>
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-lg-6">
        <mat-form-field>
          <mat-label>Password</mat-label>
          <input matInput [(ngModel)]="user.Password" [formControl]="passwordFormControl" [required]="data.addMode" 
            [type]="passwordHide ? 'password' : 'text'" (ngModelChange)="confirmPassword = undefined">
          <app-holddown-action-icon matSuffix fontSet="far" fontIconActive="fa-eye-slash" fontIcon="fa-eye" 
            [isActive]="passwordHide" (onActivate)="passwordHide = false" (onDeactivate)="passwordHide = true">
          </app-holddown-action-icon>
          <mat-error *ngIf="passwordFormControl.invalid">
            <span [innerHTML]="formControlHelper.errorMessage(passwordFormControl)"></span>
          </mat-error>
        </mat-form-field>
      </div>
      <div class="col-12 col-lg-6">
        <mat-form-field>
          <mat-label>Confirm Password</mat-label>
          <input matInput [(ngModel)]="confirmPassword" [formControl]="confirmPasswordFormControl" 
            [required]="confirmPasswordRequired()" [type]="passwordHide ? 'password' : 'text'">
          <app-holddown-action-icon matSuffix fontSet="far" fontIconActive="fa-eye-slash" fontIcon="fa-eye" 
            [isActive]="passwordHide" (onActivate)="passwordHide = false" (onDeactivate)="passwordHide = true">
          </app-holddown-action-icon>
          <mat-error *ngIf="confirmPasswordFormControl.invalid">
            <span [innerHTML]="formControlHelper.errorMessage(confirmPasswordFormControl)"></span>
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="row" *ngIf="!data.addMode">
      <div class="col-12 col-lg-4">
        <mat-form-field>
          <mat-label>Old Password</mat-label>
          <input matInput [(ngModel)]="user.OldPassword" [formControl]="oldPasswordFormControl"
            [required]="confirmPasswordRequired()" [type]="oldPasswordHide ? 'password' : 'text'">
          <app-holddown-action-icon matSuffix fontSet="far" fontIconActive="fa-eye-slash" fontIcon="fa-eye" 
            [isActive]="oldPasswordHide" (onActivate)="oldPasswordHide = false" (onDeactivate)="oldPasswordHide = true">
          </app-holddown-action-icon> 
          <mat-error *ngIf="oldPasswordFormControl.invalid">
            <span [innerHTML]="formControlHelper.errorMessage(oldPasswordFormControl)"></span>
          </mat-error>
        </mat-form-field>
      </div>
      <div class="col-12 col-lg">
      </div>
      <div class="col-12 col-lg-6">
        <p>
          <span class="accent-color">*</span>
          <small>To change the user's password enter the new password in the <span class="primary-color">'Password'</span> and <span class="primary-color">'Confirm Password'</span> fields then enter the old password in the <span class="primary-color">'Old Password'</span> field. Otherwise leave these fields blank.</small>
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <p class="primary-color">User Roles</p>
      </div>
    </div>
    <div class="row">
      <div [class]="i % 2 == 0 ? 'col-6 col-lg-3' : 'col-6 col-lg-9'" *ngFor="let role of registeredRoles; let i = index">
        <mat-checkbox [(ngModel)]="selectedRoles[role.SystemName]" [disabled]="!formControlHelper.isEnabled()">{{role.ViewName}}</mat-checkbox>
      </div>
    </div>
  </div>
</div>
<div mat-dialog-actions>
  <app-mat-spinner-button #applySpinnerBtn (btnClick)="apply()" [options]="{ active: false, text: 'Apply', spinnerSize: 19, flat: true,
    buttonColor: 'primary', spinnerColor: 'accent', disabled: formControlHelper.isError() || loadingData, mode: 'indeterminate'}">
  </app-mat-spinner-button>
  <button mat-button (click)="dialogRef.close()" [disabled]="dialogRef.disableClose">Cancel</button>
</div>